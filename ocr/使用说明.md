# OCR营业执照识别API使用说明

本文档介绍如何使用阿里云和百度云的营业执照OCR识别API。

## 文件结构

```
ocr/
├── ocr_aliyun_api.py          # 阿里云OCR API接口
├── ocr_baidu_api.py           # 百度云OCR API接口
├── ocr_license_专用接口示例.py  # 阿里云专用接口示例代码
├── ocr_config.json            # OCR配置文件
└── 使用说明.md                # 本文档
```

## 快速开始

### 1. 阿里云OCR API

#### 安装依赖
```bash
pip install alibabacloud-ocr-api20210707
pip install alibabacloud-tea-openapi
pip install alibabacloud-tea-util
```

#### 使用示例
```python
# 方法1: 使用便捷函数（推荐）
from ocr.ocr_aliyun_api import recognize_license_from_url

result = recognize_license_from_url("https://example.com/license.jpg")
if result["success"]:
    data = result["data"]["Data"]
    print(f"公司名称: {data['公司名称']}")
    print(f"统一社会信用代码: {data['注册号']}")
else:
    print(f"识别失败: {result['error']}")

# 方法2: 使用类实例
from ocr.ocr_aliyun_api import LicenseOCRAPI

ocr_api = LicenseOCRAPI()
result = ocr_api.recognize_license_from_url("https://example.com/license.jpg")
```

### 2. 百度云OCR API

#### 安装依赖
```bash
pip install requests
```

#### 使用示例
```python
# 方法1: 使用便捷函数（推荐）
from ocr.ocr_baidu_api import recognize_license_from_url

result = recognize_license_from_url("https://example.com/license.jpg")
if result["success"]:
    data = result["data"]["Data"]
    print(f"公司名称: {data['公司名称']}")
    print(f"统一社会信用代码: {data['注册号']}")
else:
    print(f"识别失败: {result['error']}")

# 方法2: 使用类实例
from ocr.ocr_baidu_api import BaiduLicenseOCRAPI

ocr_api = BaiduLicenseOCRAPI()
result = ocr_api.recognize_license_from_url("https://example.com/license.jpg")
```

## API接口说明

### 统一返回格式

所有API接口都返回统一的JSON格式：

```python
{
    "success": True/False,     # 识别是否成功
    "error": None/"错误信息",   # 错误信息（成功时为None）
    "data": {                  # 识别结果数据
        "RequestId": "请求ID",
        "Data": {              # 结构化的营业执照信息
            "注册号": "统一社会信用代码",
            "公司名称": "公司名称",
            "发证日期": "发证日期",
            "到期日期": "到期日期",
            "注册资本": "注册资本",
            "国家/地区": "中国",
            "注册地址": "注册地址",
            "成立年份": "成立日期",
            "法律形式": "公司类型",
            "法定代表人": "法定代表人"
        },
        "RawText": "原始返回数据"
    }
}
```

### 支持的输入方式

1. **URL方式**：直接传入图片URL
   ```python
   result = recognize_license_from_url("https://example.com/license.jpg")
   ```

2. **本地文件方式**：传入本地图片文件路径
   ```python
   result = recognize_license_from_file("/path/to/license.jpg")
   ```

## 配置说明

### 阿里云配置

在使用阿里云API时，需要配置以下参数：
- `access_key_id`: 阿里云AccessKey ID
- `access_key_secret`: 阿里云AccessKey Secret
- `region_id`: 服务区域（默认：cn-hangzhou）

### 百度云配置

在使用百度云API时，需要配置以下参数：
- `api_key`: 百度云API Key
- `secret_key`: 百度云Secret Key

## 错误处理

常见错误及解决方案：

1. **unsupportedImageFormat**: 图片格式不支持
   - 确保图片格式为JPG、PNG等常见格式
   - 检查图片URL是否可访问

2. **访问令牌获取失败**: 百度云API Key或Secret Key错误
   - 检查API Key和Secret Key是否正确
   - 确认百度云账户余额充足

3. **阿里云客户端未初始化**: AccessKey配置错误
   - 检查AccessKey ID和Secret是否正确
   - 确认阿里云账户权限和余额

## 性能建议

1. **缓存访问令牌**：百度云的访问令牌有效期较长，建议缓存使用
2. **批量处理**：如需处理大量图片，建议使用异步处理
3. **错误重试**：网络异常时建议实现重试机制
4. **图片优化**：上传前可适当压缩图片以提高识别速度

## 注意事项

1. 请确保图片清晰，营业执照信息完整可见
2. 支持的图片格式：JPG、PNG、BMP等
3. 建议图片大小不超过4MB
4. API调用有频率限制，请合理控制调用频次
5. 请妥善保管API密钥，避免泄露

## 技术支持

如遇到问题，请参考：
- 阿里云OCR官方文档
- 百度云OCR官方文档
- 项目中的示例代码和配置文件